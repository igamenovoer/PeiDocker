# Code Review Report: `src/pei_docker/gui/screens/simple/wizard.py`

**Date:** 2025-07-28 22:22:00

## 1. Overall Assessment

The code implements a multi-step wizard screen using the Textual framework. The implementation is functional but complex, as it builds the entire wizard logic from scratch, including step management, navigation, and state caching.

A third-party library, `textual-wizard`, exists to simplify this exact process. Adopting this library would significantly reduce code complexity, improve maintainability, and leverage a specialized, community-supported solution.

This review will focus on two aspects:
1.  How the existing code can be improved.
2.  A recommendation to use the `textual-wizard` library for a more robust and simpler implementation.

---

## 2. Review of the Existing Implementation

### 2.1. Inefficient Navigation and DOM Manipulation

**Observation:**
The `_update_step` method re-creates navigation buttons every time the user moves to a new step. This is inefficient and can cause UI flickering.

**Code Snippet:**
```python
# In _update_step()
nav_container = self.query_one(".wizard-navigation")
nav_container.remove_children()
# ... buttons are recreated and mounted ...
```

**Recommendation:**
The buttons should be created once in the `compose` method. Their state (enabled/disabled) and visibility should be managed in `_update_step` by modifying their properties (`disabled`, `display`). This is a more idiomatic and performant approach in Textual.

**Example:**
```python
# In compose()
yield Button("Save", id="save", variant="success", style="display: none;")

# In _update_step()
save_btn = self.query_one("#save", Button)
is_last_step = self.current_step >= len(self.steps) - 1
save_btn.display = is_last_step
```

### 2.2. Unsafe Widget Querying

**Observation:**
A broad `try...except` block is used to handle cases where a button might not be found. This can hide other errors.

**Code Snippet:**
```python
try:
    prev_btn = self.query_one("#prev", Button) 
    prev_btn.disabled = self.current_step == 0
except:
    pass  # Button might not exist yet
```

**Recommendation:**
Import and catch the specific `NoMatches` exception from `textual.css.query` for safer and more precise error handling.

### 2.3. Dead Code

**Observation:**
The method `_get_current_step_screen` is defined but never called.

**Recommendation:**
Remove the unused method to improve code clarity.

---

## 3. Recommendation: Adopt `textual-wizard`

**Online-Examples & API-Doc:**
My research identified the [`textual-wizard`](https://textual-wizard.skwal.net/) library, which is purpose-built for creating wizards in Textual.

**API Usage:**
The library provides a high-level `Wizard` class that abstracts away the complexities of step management, state, and navigation.

**Example from `textual-wizard` documentation:**
```python
from textual_wizard import Wizard
from textual_wizard.inputs import Text, Integer

my_wizard = Wizard(
    questions=[
        Text(name="first_name", placeholder="Your first name"),
        Text(name="last_name", placeholder="Your last name"),
        Integer(name="age", placeholder="Your age"),
    ],
    title="My Awesome App"
)
answers = my_wizard.run()
```

**Conclusion:**
Refactoring `SimpleWizardScreen` to use `textual-wizard` would:
-   **Drastically Reduce Code Size:** The entire custom logic for `_update_step`, `_create_steps`, `action_back`, `action_next`, etc., could be replaced by the library's implementation.
-   **Improve Maintainability:** The code would be much simpler and easier to understand.
-   **Leverage a Specialized Solution:** Benefit from the features and bug fixes of a library dedicated to this component.

Refactoring would involve defining the wizard steps using `textual-wizard`'s input types and then running the wizard. The current implementation, while functional, essentially reinvents the wheel.
